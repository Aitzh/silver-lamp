# üîÑ Fix Duplicates - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

**Fix Duplicates** - –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Coffee Books AI.

### –ü—Ä–æ–±–ª–µ–º–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:

–ü—Ä–∏ —Å–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (Google Books, Spotify, TMDB) –º–æ–≥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã:
- –û–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –∫–Ω–∏–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–≤–∞–∂–¥—ã
- –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç—Ä–µ–∫ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
- –§–∏–ª—å–º –¥–æ–±–∞–≤–ª–µ–Ω –∏–∑ trending –∏ –∏–∑ –∂–∞–Ω—Ä–æ–≤–æ–π –ø–æ–¥–±–æ—Ä–∫–∏

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:

### 1Ô∏è‚É£ **–ü–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**
–ò—â–µ—Ç –∑–∞–ø–∏—Å–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏:
- `title` (–Ω–∞–∑–≤–∞–Ω–∏–µ, case-insensitive)
- `creator` (–∞–≤—Ç–æ—Ä/–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, case-insensitive)
- `type` (book/movie/music)

### 2Ô∏è‚É£ **–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞**
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥—É–±–ª–∏–∫–∞—Ç–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç "–∫–∞—á–µ—Å—Ç–≤–æ" (0-10 –±–∞–ª–ª–æ–≤):

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ë–∞–ª–ª—ã |
|----------|-------|
| –ï—Å—Ç—å description | +1 |
| –ï—Å—Ç—å image_url | +1 |
| –ï—Å—Ç—å year | +1 |
| –ï—Å—Ç—å rating | +1 |
| –ï—Å—Ç—å mood | +1 |
| –ï—Å—Ç—å genre | +1 |
| –ï—Å—Ç—å epoch | +1 |
| –ï—Å—Ç—å AI-–æ–ø–∏—Å–∞–Ω–∏–µ (needs_ai=0) | +2 |
| –ï—Å—Ç—å source_id | +1 |

**–ú–∞–∫—Å–∏–º—É–º: 10 –±–∞–ª–ª–æ–≤**

### 3Ô∏è‚É£ **–í—ã–±–æ—Ä –ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–∏**
- –û—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º
- –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–ø–∏–∏

### 4Ô∏è‚É£ **–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞**
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å—è—Ö
- –°–æ–∑–¥–∞–µ—Ç JSON –æ—Ç—á–µ—Ç –¥–ª—è –∞—É–¥–∏—Ç–∞

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1Ô∏è‚É£ –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
mkdir -p scripts/migrations

# –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
mv fix_duplicates.py scripts/migrations/

# –°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x scripts/migrations/fix_duplicates.py
```

### 2Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
python scripts/migrations/fix_duplicates.py
```

---

## üìä –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 1: Backup

```
======================================================================
            üîÑ FIX DUPLICATES - –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
======================================================================

1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏...
‚úÖ Backup —Å–æ–∑–¥–∞–Ω: backups/content_backup_20250121_160000.db
```

### –®–∞–≥ 2: –ü–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

```
üîç –ü–û–ò–°–ö –î–£–ë–õ–ò–ö–ê–¢–û–í
======================================================================
–ù–∞–π–¥–µ–Ω–æ –≥—Ä—É–ø–ø –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: 5
```

### –®–∞–≥ 3: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

```
üìã –î–ï–¢–ê–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –î–£–ë–õ–ò–ö–ê–¢–ê–•
======================================================================

1. üé¨ 'Inception'
   –ê–≤—Ç–æ—Ä/–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: Christopher Nolan
   –¢–∏–ø: movie | –ö–æ–ø–∏–π: 3
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   1. ID 1234 - –ö–∞—á–µ—Å—Ç–≤–æ: 8/10 - ‚úÖ –û–°–¢–ê–í–ò–¢–¨
      –û–ø–∏—Å–∞–Ω–∏–µ: A mind-bending thriller about dream invasion...
      –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: Yes | –ì–æ–¥: 2010
      Rating: 8.8 | AI: –ï—Å—Ç—å

   2. ID 5678 - –ö–∞—á–µ—Å—Ç–≤–æ: 6/10 - ‚ùå –£–î–ê–õ–ò–¢–¨
      –û–ø–∏—Å–∞–Ω–∏–µ: –ù–µ—Ç
      –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: Yes | –ì–æ–¥: 2010
      Rating: 8.8 | AI: –ù—É–∂–µ–Ω

   3. ID 9012 - –ö–∞—á–µ—Å—Ç–≤–æ: 5/10 - ‚ùå –£–î–ê–õ–ò–¢–¨
      –û–ø–∏—Å–∞–Ω–∏–µ: –ù–µ—Ç
      –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: No | –ì–æ–¥: 2010
      Rating: N/A | AI: –ù—É–∂–µ–Ω

2. üéµ 'Bohemian Rhapsody'
   –ê–≤—Ç–æ—Ä/–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: Queen
   –¢–∏–ø: music | –ö–æ–ø–∏–π: 2
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   1. ID 3456 - –ö–∞—á–µ—Å—Ç–≤–æ: 7/10 - ‚úÖ –û–°–¢–ê–í–ò–¢–¨
      –û–ø–∏—Å–∞–Ω–∏–µ: Epic rock masterpiece with operatic elements...
      –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: Yes | –ì–æ–¥: 1975
      Rating: N/A | AI: –ï—Å—Ç—å

   2. ID 7890 - –ö–∞—á–µ—Å—Ç–≤–æ: 4/10 - ‚ùå –£–î–ê–õ–ò–¢–¨
      –û–ø–∏—Å–∞–Ω–∏–µ: –ù–µ—Ç
      –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: Yes | –ì–æ–¥: 1975
      Rating: N/A | AI: –ù—É–∂–µ–Ω

...
```

### –®–∞–≥ 4: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

```
‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï!
   –ù–∞–π–¥–µ–Ω–æ 5 –≥—Ä—É–ø–ø –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   –ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 8
   –ë—É–¥–µ—Ç –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –ª—É—á—à–∏—Ö –≤–µ—Ä—Å–∏–π: 5

üíæ Backup —Å–æ—Ö—Ä–∞–Ω–µ–Ω: backups/content_backup_20250121_160000.db

‚ùì –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ? (yes/no): yes
```

### –®–∞–≥ 5: –£–¥–∞–ª–µ–Ω–∏–µ

```
üßπ –£–î–ê–õ–ï–ù–ò–ï –î–£–ë–õ–ò–ö–ê–¢–û–í
======================================================================

‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º: ID 1234 - 'Inception' (–∫–∞—á–µ—Å—Ç–≤–æ: 8)
   ‚ùå –£–¥–∞–ª—è–µ–º: ID 5678 (–∫–∞—á–µ—Å—Ç–≤–æ: 6)
   ‚ùå –£–¥–∞–ª—è–µ–º: ID 9012 (–∫–∞—á–µ—Å—Ç–≤–æ: 5)

‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º: ID 3456 - 'Bohemian Rhapsody' (–∫–∞—á–µ—Å—Ç–≤–æ: 7)
   ‚ùå –£–¥–∞–ª—è–µ–º: ID 7890 (–∫–∞—á–µ—Å—Ç–≤–æ: 4)

...

======================================================================
‚úÖ –£–¥–∞–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 8
‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω–æ –ª—É—á—à–∏—Ö –≤–µ—Ä—Å–∏–π: 5
======================================================================
```

### –®–∞–≥ 6: –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

```
üìä –ò–¢–û–ì–û–í–ê–Ø –°–í–û–î–ö–ê
======================================================================
–ì—Ä—É–ø–ø –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–∞–π–¥–µ–Ω–æ: 5
–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –î–û: 11,215
–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –ü–û–°–õ–ï: 11,207
–£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: 8
–û—Å—Ç–∞–≤–ª–µ–Ω–æ –ª—É—á—à–∏—Ö –≤–µ—Ä—Å–∏–π: 5
–û—á–∏—â–µ–Ω–æ: 0.07% –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
======================================================================
```

### –®–∞–≥ 7: –û—Ç—á–µ—Ç

```
üìÑ –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: reports/duplicates_removed_20250121_160000.json
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—á–µ—Ç–∞:**

```json
{
  "timestamp": "2025-01-21T16:00:00",
  "database": "content.db",
  "backup": "backups/content_backup_20250121_160000.db",
  "statistics": {
    "total_duplicate_groups": 5,
    "total_records_before": 11215,
    "total_records_after": 11207,
    "records_deleted": 8,
    "records_kept": 5
  },
  "deleted_records": [
    {
      "id": 5678,
      "title": "inception",
      "creator": "christopher nolan",
      "type": "movie",
      "quality_score": 6,
      "kept_instead": 1234
    },
    ...
  ]
}
```

---

## üîß –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–∏

### –ü—Ä–∏–º–µ—Ä: 3 –∫–æ–ø–∏–∏ "Inception"

| ID | Description | Image | Year | Rating | AI | source_id | **–ö–∞—á–µ—Å—Ç–≤–æ** |
|----|-------------|-------|------|--------|----|-----------| ------------ |
| 1234 | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | **8/10** ‚Üê **–û–°–¢–ê–í–ò–¢–¨** |
| 5678 | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ | 6/10 ‚Üê –£–î–ê–õ–ò–¢–¨ |
| 9012 | ‚ùå | ‚ùå | ‚úÖ | ‚ùå | ‚ùå | ‚úÖ | 5/10 ‚Üê –£–î–ê–õ–ò–¢–¨ |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Å—Ç–∞–≤–ª—è–µ–º ID 1234 (—Å–∞–º–æ–µ –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)

---

## üíæ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```bash
# 1. –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π backup
ls -lt backups/

# 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
cp backups/content_backup_YYYYMMDD_HHMMSS.db content.db

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
python scripts/tools/db_inspector.py --duplicates
```

---

## üéØ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ –±—É–¥—É—â–µ–º

### 1Ô∏è‚É£ **–î–æ–±–∞–≤—å—Ç–µ UNIQUE constraint**

```sql
-- –°–¥–µ–ª–∞–π—Ç–µ source_id —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
CREATE UNIQUE INDEX IF NOT EXISTS idx_source_id ON content(source_id);
```

### 2Ô∏è‚É£ **–û–±–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–±–æ—Ä–∞**

**–§–∞–π–ª: `harvest_books.py`**

```python
# –î–û (—Å–æ–∑–¥–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã)
def save_book(book_data):
    cursor.execute("""
        INSERT INTO content (title, creator, ...)
        VALUES (?, ?, ...)
    """, (...))

# –ü–û–°–õ–ï (–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
def save_book(book_data):
    google_id = book_data['id']
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
    cursor.execute("""
        SELECT id FROM content 
        WHERE source_id = ? AND type = 'book'
    """, (google_id,))
    
    existing = cursor.fetchone()
    
    if existing:
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
        cursor.execute("""
            UPDATE content 
            SET title = ?, creator = ?, description = ?, ...
            WHERE id = ?
        """, (..., existing[0]))
    else:
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
        cursor.execute("""
            INSERT INTO content (source_id, title, creator, ...)
            VALUES (?, ?, ?, ...)
        """, (google_id, ...))
```

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è:**
- `harvest_movies.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ TMDB ID
- `harvest_music.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ Spotify Track ID

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–∞–π–¥–µ–Ω–æ 0 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL
sqlite3 content.db "
  SELECT title, creator, type, COUNT(*) 
  FROM content 
  GROUP BY LOWER(title), LOWER(creator), type 
  HAVING COUNT(*) > 1
"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª—è–µ—Ç –Ω–µ —Ç—É –∑–∞–ø–∏—Å—å

```bash
# –û—Ç–∫–∞—Ç–∏—Ç–µ –∏–∑ backup
cp backups/content_backup_LATEST.db content.db

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–ª–≥–æ—Ä–∏—Ç–º –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
# –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å QUALITY_FIELDS
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É reports
mkdir -p reports
chmod 755 reports
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```bash
# 1. –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
python scripts/tools/db_inspector.py

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
python scripts/tools/db_inspector.py --duplicates

# 3. SQL –ø—Ä–æ–≤–µ—Ä–∫–∞
sqlite3 content.db "
  SELECT 
    type,
    COUNT(*) as total,
    COUNT(DISTINCT source_id) as unique_sources
  FROM content
  GROUP BY type
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã! ‚úÖ
```

---

## üéì Best Practices

### 1Ô∏è‚É£ **–†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**

```bash
# –†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç—ã
python scripts/tools/db_inspector.py --duplicates
```

### 2Ô∏è‚É£ **–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º**

```bash
# –í—Å–µ–≥–¥–∞ –æ—á–∏—â–∞–π—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º
python scripts/migrations/fix_duplicates.py
```

### 3Ô∏è‚É£ **–í–µ–¥–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏**

```bash
# –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –æ—Ç—á–µ—Ç—ã –¥–ª—è –∞—É–¥–∏—Ç–∞
ls -lh reports/duplicates_removed_*.json
```

### 4Ô∏è‚É£ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**

```bash
#!/bin/bash
# weekly_maintenance.sh

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤..."
python scripts/tools/db_inspector.py --duplicates > reports/weekly_check.txt

# –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã - —É–≤–µ–¥–æ–º–∏—Ç—å
if grep -q "–≥—Ä—É–ø–ø –¥—É–±–ª–∏–∫–∞—Ç–æ–≤" reports/weekly_check.txt; then
    echo "‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã! –ó–∞–ø—É—Å—Ç–∏—Ç–µ fix_duplicates.py"
fi
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:**
   ```bash
   python scripts/tools/db_inspector.py
   ```

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI-–æ–ø–∏—Å–∞–Ω–∏–π:**
   ```bash
   python scripts/tools/ai_describer.py --limit=100
   ```

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å–±–æ—Ä–∞:**
   - –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ `source_id`
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `INSERT OR REPLACE`

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ backup –≤ `backups/`
2. –ò–∑—É—á–∏—Ç–µ –æ—Ç—á–µ—Ç –≤ `reports/`
3. –û—Ç–∫–∞—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** –Ø–Ω–≤–∞—Ä—å 2025  
**–ê–≤—Ç–æ—Ä:** Coffee Books AI Team

**üéâ –£–¥–∞—á–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤!**
